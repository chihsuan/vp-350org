!function(t){function e(t,e,u,d,l,s){var p=d3.geo.mercator().scale(function(){return c?d:u}).center(e).translate([o/2+10,i/2+50]);d3.geo.path().projection(p);document.getElementById("bank-vis-title").innerText="Financiers for "+t+" Coal Plant",document.getElementById("project-vis-title").innerText="Coal Plants in "+t,document.getElementById("bank-proj-vis-title").innerText="List of Financing Country and Project",d3.csv(l,function(t){var e=t.filter(function(t){return t["Project Name"]||t.plant}).map(function(t){return t.value=parseFloat(t["Capacity (MW)"]),t.name=t["Project Name"]?t["Project Name"]:t.plant,t.name=t.name.replace("station",""),t}),i={};e.forEach(function(t){i.hasOwnProperty(t.name)?i[t.name].value+=t.value:i[t.name]=t});var c=[];Object.keys(i).forEach(function(t,e){c.push(i[t])});var u=d3.layout.treemap().size([o,500]),d=u.nodes({children:c});d=d.slice(1,d.length);var l=d3.select("#proj-treemap").append("svg").attr("width",o).attr("height",500),s=l.selectAll("g").data(d).enter().append("g").on("mousemove",function(t){a(t,"<strong>Project Name:"+t.name+"</strong><p>Capacity (MW): "+t.value.toFixed(2)+"</p>")}).on("mouseout",r);s.append("rect").attr({x:function(t){return t.x},y:function(t){return t.y},width:function(t){return t.dx},height:function(t){return t.dy},class:"proj-treemap-rect"}),s.append("text").attr({x:function(t){return t.x+t.dx/2},y:function(t){return t.y+t.dy/2},"text-anchor":"middle","dominant-baseline":"central"}).text(function(t){return t.name}).each(n);var p=c.reduce(function(t,e){return{value:t.value+e.value}});document.getElementById("proj-total").innerText=p.value+" (MW)";new Vue({el:"#proj-table",data:{plantData:c},computed:{projArray:function(){return this.plantData.sort(function(t,e){return t.name<e.name?-1:t.name>e.name?1:t.Unit<e.Unit?-1:t.Unit>e.Unit?1:0})}}})}),"Japan"!==t?d3.csv(s,function(t){var e=[];t.forEach(function(t){t.value=parseFloat(t["Total Investing Amount"]),t.name=t["Financier's name"]}),e=t;var i={value:0};if(e.length>0&&(i=e.reduce(function(t,e){return{value:t.value+e.value}})),document.getElementById("bank-vis").className="",i.value>0){i=i.value.toFixed(2),document.getElementById("bank-invest-total").innerText=i+" (mio USD)";var c=d3.layout.treemap().size([o,500]),u=c.nodes({children:e});u=u.slice(1,u.length);var d=d3.select("#bank-treemap").append("svg").attr("width",o).attr("height",500),l=d.selectAll("g").data(u).enter().append("g").on("mousemove",function(t){a(t,"<strong>Bank Name:"+t.name+"</strong><p>Investing Amount(mio USD): "+t.value.toFixed(2)+"</p>")}).on("mouseout",r);l.append("rect").attr({x:function(t){return t.x},y:function(t){return t.y},width:function(t){return t.dx},height:function(t){return t.dy},class:"bank-treemap-rect"}),l.append("text").attr({x:function(t){return t.x+t.dx/2},y:function(t){return t.y+t.dy/2},"text-anchor":"middle","dominant-baseline":"central"}).text(function(t){return t.name}).each(n)}new Vue({el:"#bank-table",data:{bank:e},computed:{bankArray:function(){return this.bank.sort(function(t,e){return t["Project Name"]<e["Project Name"]?-1:t["Project Name"]>e["Project Name"]?1:t.Unit<e.Unit?-1:t.Unit>e.Unit?1:0})}}})}):(document.getElementById("bank-proj-vis").className="",d3.csv(s,function(t){new Vue({el:"#bank-proj-table",data:{bank:t},computed:{bankArray:function(){return this.bank.sort(function(t,e){return 0})}}})}))}function n(t,e){var n=16,a=t.name,r=t.dx,o=t.dy;if(a){for(d3.select(this).style("font-size",n+"px");(this.getBBox().width>=r||this.getBBox().height>=o)&&n>10;)n--,d3.select(this).style("font-size",n+"px"),this.firstChild.data=a;this.parentNode.childNodes[0].getBBox().width-.5<this.getBBox().width&&d3.select(this).style("display","none")}}function a(t,e){var n=d3.event.pageX+5,a=d3.event.pageY+5;d3.select("#tooltip").style("left",n+"px").style("top",a+"px").html(function(){return e}),d3.select("#tooltip").classed("hidden",!1)}function r(){d3.select("#tooltip").classed("hidden",!0)}var o=$(t).width(),i=$(t).height(),c=o<600;d3.select("#country-map").append("svg").attr("width",o).attr("height",i);d3.select("body").append("div").attr("id","tooltip").classed("hidden",!0),t.init=e}(window);