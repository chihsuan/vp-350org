!function(t){function e(t,e){var r=i-40,o=function(t){return t.destination.replace(" ","")+"-link"},u=d3.max(t,function(t){return t.value}),l=d3.scale.linear().domain([0,u]).range([5,15]);e.forEach(function(t){-1===n.indexOf(t.properties.name)&&(f[t.properties.name]=d.centroid(t))});var g=t.filter(function(t){return t.source==t.destination&&(x[t.source]={value:t.value,no:t["No."]}),a.indexOf(t.source)>-1&&t.source!==t.destination}),y=c.selectAll(".defs").data(g).enter().append("svg:defs"),v=function(t){return"marker"+t.source.replace(" ","")+t.destination.replace(" ","")};y.append("marker").attr("id",v).attr("viewBox","0 -5 10 10").attr("refX",5).attr("refY",0).attr("orient","auto").attr("markerUnits","userSpaceOnUse").attr("markerWidth",function(t){return 3.5*l(t.value)}).attr("markerHeight",function(t){return 2.5*l(t.value)}).append("path").attr("d","M0,-5L10,0L0,5").attr("fill","rgba(196, 0, 0, 0.75)");var m=function(t){return"grd"+t.source.replace(" ","")+t.destination.replace(" ","")},h=function(t){return"url(#"+m(t)+")"},k=d3.scale.log().domain([1,u]).range(["rgb(193,39,45)","#b52626"]),b=function(t){return k(t.value)},w=y.selectAll("linearGradient").data(g).enter().append("svg:linearGradient").attr("id",m).attr("gradientUnits","userSpaceOnUse").attr("x1",function(t){return f[t.source][0]}).attr("y1",function(t){return f[t.source][1]}).attr("x2",function(t){return f[t.destination][0]}).attr("y2",function(t){return f[t.destination][0]});w.append("svg:stop").attr("offset","0%").attr("stop-color","rgb(193,39,45)").attr("stop-opacity",.2),w.append("svg:stop").attr("offset","80%").attr("stop-color",b).attr("stop-opacity",1),w.append("svg:stop").attr("offset","100%").attr("stop-color",b).attr("stop-opacity",1);var O=c.append("g").attr("id","arcs"),A=O.selectAll("g").data(g).enter().append("g");A.append("path").attr("stroke",h).attr("stroke-linecap","round").attr("stroke-width",function(t){return l(t.value)}).attr("class",o).attr("d",function(t){return d({type:"LineString",coordinates:[p.invert(f[t.source]),p.invert(f[t.destination])]})}).style("display","none");A.append("circle").attr("cx",function(t){return f[t.source][0]}).attr("cy",function(t){return f[t.source][1]-5}).attr("class",o).attr("r",function(t){return t.value>1e3?45:30}).style("display","none").attr("text-anchor","middle"),A.append("svg:image").attr("xlink:href",function(t){return"./img/plant.svg"}).attr("x",function(t){return f[t.source][0]-21}).attr("y",function(t){return f[t.source][1]-24}).attr("class",o).attr("height",15).attr("width",18).style("display","none"),A.append("text").attr("x",function(t){return f[t.source][0]}).attr("y",function(t){return f[t.source][1]-10}).attr("class",o).text(function(t){if(t["No."])return""+t["No."]}).style("display","none"),A.append("text").attr("x",function(t){return f[t.source][0]}).attr("y",function(t){return f[t.source][1]+10}).attr("class",o).text(function(t){if(t.value)return"＄"+t.value.toFixed(0)}).style("display","none").attr("text-anchor","middle"),s||(c.append("text").attr("x",25).attr("y",i/5*2.2).attr("class","w-title").text("JOIN DIVESTMENT MOVEMENT!"),c.append("text").attr("x",25).attr("y",i/5*2.2+26).attr("class","w-sub-title").text("STOP EAST ASIA FOSSIL FUEL FINANCIAL FLOW!")),c.append("line").attr("x1",16).attr("y1",r-43).attr("x2",30).attr("y2",r-43).attr("stroke","rgb(255,169,2)").attr("stroke-width",15),c.append("text").attr("x",35).attr("y",r-38).attr("class","legend").text("Investment flows to other countries"),c.append("line").attr("x1",16).attr("y1",r-24).attr("x2",30).attr("y2",r-24).attr("stroke","#b52626").attr("stroke-width",15),c.append("text").attr("x",35).attr("y",r-18).attr("class","legend").text("Projects being financed from other countries"),c.append("text").attr("x",15).attr("y",r+5).attr("class","legend").text("$ = Million USD"),c.append("svg:image").attr("xlink:href",function(t){return"./img/plant.svg"}).attr("x",15).attr("y",r+13).attr("width",20),c.append("text").attr("x",50).attr("y",r+27).attr("class","legend").text("= Coal Plant No.")}function r(t,e){var r=function(t){return t.source.replace(" ","")+"-link"},o=d3.max(t,function(t){return t.value}),i=d3.scale.linear().domain([0,o]).range([5,15]);e.forEach(function(t){-1===n.indexOf(t.properties.name)&&(f[t.properties.name]=d.centroid(t))});var s=t.filter(function(t){return t.source==t.destination&&(x[t.source]={value:t.value,no:t["No."]}),a.indexOf(t.source)>-1&&t.source!==t.destination}),u=c.selectAll(".defs").data(s).enter().append("svg:defs"),l=function(t){return"grd"+t.destination.replace(" ","")+t.source.replace(" ","")},g=function(t){return"url(#"+l(t)+")"},y=d3.scale.log().domain([1,o]).range(["rgb(255,169,2)","rgb(255,169,2)"]),v=function(t){return y(t.value)},m=u.selectAll("linearGradient").data(s).enter().append("svg:linearGradient").attr("id",l).attr("gradientUnits","userSpaceOnUse").attr("x1",function(t){return f[t.source][0]}).attr("y1",function(t){return f[t.source][1]}).attr("x2",function(t){return f[t.destination][0]}).attr("y2",function(t){return f[t.destination][0]});m.append("svg:stop").attr("offset","0%").attr("stop-color","rgb(255,169,2)").attr("stop-opacity",.2),m.append("svg:stop").attr("offset","80%").attr("stop-color",v).attr("stop-opacity",1),m.append("svg:stop").attr("offset","100%").attr("stop-color",v).attr("stop-opacity",1);var h=c.append("g").attr("id","arcs"),k=h.selectAll("g").data(s).enter().append("g");k.append("path").attr("stroke",g).attr("stroke-linecap","round").attr("stroke-width",function(t){return i(t.value)}).attr("class",r).attr("d",function(t){return d({type:"LineString",coordinates:[p.invert(f[t.source]),p.invert(f[t.destination])]})}).style("display","none");k.append("circle").attr("cx",function(t){return f[t.destination][0]}).attr("cy",function(t){return f[t.destination][1]-5}).attr("class",r).attr("r",function(t){return t.value>1e3?45:30}).style("display","none").attr("text-anchor","middle").style("fill","rgba(255,169,2, 0.75)").style("stroke","rgb(255,169,2)"),k.append("svg:image").attr("xlink:href",function(t){return"./img/plant.svg"}).attr("x",function(t){return f[t.destination][0]-21}).attr("y",function(t){return f[t.destination][1]-24}).attr("class",r).attr("height",15).attr("width",18).style("display","none"),k.append("text").attr("x",function(t){return f[t.destination][0]}).attr("y",function(t){return f[t.destination][1]-10}).attr("class",r).text(function(t){if(t["No."])return""+t["No."]}).style("display","none"),k.append("text").attr("x",function(t){return f[t.destination][0]}).attr("y",function(t){return f[t.destination][1]+10}).attr("class",r).text(function(t){if(t.value)return"＄"+t.value.toFixed(0)}).style("display","none").attr("text-anchor","middle")}var n=["Vietnam","Japan","Taiwan","South Korea","Indonesia","Philippines"],a=["China","Taiwan","Japan","Vietnam","North Korea","South Korea","Philippines","Thailand","Malaysia","Indonesia","Cambodia","Laos","Myanmar","Singapore","Brunei","East Timor","Mongolia"],o=$(t).width(),i=$(t).height(),s=o<769,c=d3.select("#east-asia-map").append("svg").attr("width",o).attr("height",i),u=s?200:450,l=[107,25],p=d3.geo.mercator().scale(u).center(l).translate([o/2+10,i/2+50]),d=d3.geo.path().projection(p),f={Vietnam:p([105.51,21.02]),Japan:p([139.4254,35.422]),Taiwan:p([121.564558,25.105497]),"South Korea":p([126.5841,37.34]),Indonesia:p([106.48,6.12]),Philippines:p([120.58,14.35])},x={};if(s){var g=n.slice();g.unshift("Select A Country"),d3.select("body").append("form").attr("class","m-country-select form-group").append("select").attr("class","form-control").on("change",function(e){t.location.href="./"+this.value.toLowerCase()}).selectAll("option").data(g).enter().append("option").attr("value",function(t){return t}).text(function(t){return t})}d3.json("./data/countries.geo.topo.json",function(u,l){if(u)return console.error(u);var p=topojson.feature(l,l.objects["countries.geo"]).features.filter(function(t){return a.indexOf(t.properties.name)>-1});c.append("g").attr("class","countries").selectAll("path").data(p).enter().append("path").attr("d",d).style("cursor",function(t){if(n.indexOf(t.properties.name)>-1)return"pointer"}).style("fill",function(t){if(n.indexOf(t.properties.name)>-1)return"rgba(255, 255, 255, 0.75)"}).on("mouseover",function(t){var e=t.properties.name;n.indexOf(e)>-1&&(d3.select(this).style("opacity",.8),d3.selectAll("."+e.replace(" ","")+"-link").style("display","block"),x.hasOwnProperty(e)&&x[e].value&&d3.select("#map-sub-title").text("Domestic：$ "+x[e].value+" / Plant No. "+x[e].no)),d3.select(".map-title").text(e)}).on("mouseout",function(t){d3.select(this).style("opacity",1),d3.select(".map-title").text("East Asia"),d3.selectAll("."+t.properties.name.replace(" ","")+"-link").style("display","none"),d3.select("#map-sub-title").text("")}).on("click",function(e){n.indexOf(e.properties.name)>-1&&(t.location.href="./"+e.properties.name.toLowerCase())}),c.append("path").attr("class","country-borders").attr("d",d(topojson.mesh(l,l.objects["countries.geo"],function(t,e){return a.indexOf(t.properties.name)>-1&&t!==e}))),c.append("text").text("East Asia").attr("class","map-title").attr("text-anchor","middle").attr("y",function(){return s?"50":i/2+50}).attr("x",function(){return s?o/2:o/6*5}),s||c.append("text").text("12").attr("id","map-sub-title").attr("text-anchor","middle").attr("y",function(){return i/2+75}).attr("x",function(){return o/6*5}),d3.csv("./data/flow.csv",function(t){return t.value=+t.value,t},function(t){e(t,p)}),d3.csv("./data/[ VP ] Sum up Coal Plant No. - mainpage-JP.csv",function(t){return t.value=+t.value,t},function(t){r(t,p)})})}(window);