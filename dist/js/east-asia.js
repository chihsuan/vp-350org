!function(t){function e(t){var e=o-40,r=d3.max(d,function(t){return t.value}),a=d3.scale.linear().domain([0,r]).range([.5,5]),n=s.append("svg:defs"),p={};t.forEach(function(t){p[t.properties.name]=u.centroid(t)}),n.append("marker").attr("id","arrowHead").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("orient","auto").attr("markerUnits","userSpaceOnUse").attr("markerWidth",16).attr("markerHeight",12).append("polyline").attr("points","0,0 10,5 0,10 1,5").attr("fill","red").attr("stroke","#c50303");var c=function(t){return"grd"+t.source.replace(" ","")+t.target.replace(" ","")},f=function(t){return"url(#"+c(t)+")"},g=d3.scale.log().domain([1,r]).range(["rgb(193,39,45)","#b52626"]),m=function(t){return g(t.value)},y=n.selectAll("linearGradient").data(d).enter().append("svg:linearGradient").attr("id",c).attr("gradientUnits","userSpaceOnUse").attr("x1",function(t){return p[t.source][0]}).attr("y1",function(t){return p[t.source][1]}).attr("x2",function(t){return p[t.target][0]}).attr("y2",function(t){return p[t.target][0]});y.append("svg:stop").attr("offset","0%").attr("stop-color","rgb(193,39,45)").attr("stop-opacity",.2),y.append("svg:stop").attr("offset","70%").attr("stop-color",m).attr("stop-opacity",1),y.append("svg:stop").attr("offset","100%").attr("stop-color",m).attr("stop-opacity",1);var h=s.append("g").attr("id","arcs"),x=h.selectAll("g").data(d).enter().append("g");x.append("path").attr("stroke",f).attr("stroke-linecap","round").attr("stroke-width",function(t){return a(t.value)}).attr("class",function(t){return t.target+"-link"}).attr("d",function(t){return u({type:"LineString",coordinates:[l.invert(p[t.source]),l.invert(p[t.target])]})}).attr("marker-end","url(#arrowHead)").style("opacity",0);x.append("text").attr("x",function(t){return p[t.source][0]}).attr("y",function(t){return p[t.source][1]-5}).attr("class",function(t){return t.target+"-link"}).text(function(t){return console.log(t),t.value+""}).style("opacity",0).attr("text-anchor","middle"),s.append("line").attr("x1",10).attr("y1",e).attr("x2",20).attr("y2",e).attr("stroke","#b52626").attr("stroke-width",6),s.append("circle").attr("cx",14).attr("cy",function(){return i?e+20:e+25}).attr("r","5px").style("fill","#fff").style("stroke","none"),s.append("text").attr("x",25).attr("y",e+5).attr("class","legend").text("Fossil Investment Flow (Million USD)"),s.append("text").attr("x",25).attr("y",function(){return i?e+25:e+30}).attr("r","8px").attr("fill","red").attr("class","legend").text("Data Last Updatedï¼š2017")}var r=["Vietnam","Japan","Taiwan","South Korea","Indonesia","Philippines"],a=["China","Taiwan","Japan","Vietnam","North Korea","South Korea","Philippines","Thailand","Malaysia","Indonesia","Cambodia","Laos","Myanmar","Singapore","Brunei","East Timor","Mongolia"],n=$(t).width(),o=$(t).height(),i=n<600,s=d3.select("#east-asia-map").append("svg").attr("width",n).attr("height",o),p=i?200:500,c=[107,25],l=d3.geo.mercator().scale(p).center(c).translate([n/2+10,o/2+50]),u=d3.geo.path().projection(l),d=[{source:"China",target:"Vietnam",value:300},{source:"Japan",target:"Vietnam",value:200},{source:"South Korea",target:"Vietnam",value:100}];d3.json("./data/countries.geo.topo.json",function(p,c){if(p)return console.error(p);var l=topojson.feature(c,c.objects["countries.geo"]).features.filter(function(t){return a.indexOf(t.properties.name)>-1});s.append("g").attr("class","countries").selectAll("path").data(l).enter().append("path").attr("d",u).style("cursor",function(t){if(r.indexOf(t.properties.name)>-1)return"pointer"}).on("mouseover",function(t){r.indexOf(t.properties.name)>-1&&(d3.select(this).style("fill","#c70e0e").style("stroke","#b52626"),d3.selectAll("."+t.properties.name+"-link").style("opacity",1)),d3.select(".map-title").text(t.properties.name)}).on("mouseout",function(t){d3.select(this).style("fill","").style("stroke",""),d3.select(".map-title").text("East Asia"),d3.selectAll("."+t.properties.name+"-link").style("opacity",0)}).on("click",function(e){r.indexOf(e.properties.name)>-1&&(t.location.href="./"+e.properties.name.toLowerCase())}),s.append("path").attr("class","country-borders").attr("d",u(topojson.mesh(c,c.objects["countries.geo"],function(t,e){return a.indexOf(t.properties.name)>-1&&t!==e}))),s.append("text").text("East Asia").attr("class","map-title").attr("text-anchor","middle").attr("y",function(){return i?"115":o/2+50}).attr("x",function(){return i?n/2:n/6*5}),e(l)})}(window);