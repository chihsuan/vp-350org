!function(t){function e(e,p,s,u,l,d){var f=o<600;f&&(s=u);var g=d3.geo.mercator().scale(s).center(p).translate([o/2+10,i/2+50]),m=d3.geo.path().projection(g),h={};d3.csv("./data/[ VP ] Sum up Coal Plant No. - sub-page- Coal Plant No..csv",function(t){t.forEach(function(t){h[t.Country]=t["Coal Plant No."]})}),d3.json("./data/countries.geo.topo.json",function(p,s){d3.csv(l,function(u){if(p)return console.error(p);var l=topojson.feature(s,s.objects["countries.geo"]).features;l=l.filter(function(t){return t.properties.name===e}),c.append("g").attr("class","countries").selectAll("path").data(l).enter().append("path").attr("d",m).style("display",function(t){return r.indexOf(t.properties.name)>-1?"block":"none"}),c.append("path").attr("class","country-borders").attr("d",m(topojson.mesh(s,s.objects["countries.geo"],function(t,a){return t.properties.name===e&&t!==a}))),u=u.filter(function(t){return t.Latitude&&t.Longitude&&(t["Project Name"]||t.plant)}).map(function(t){return t.Longitude=parseFloat(t.Longitude),t.Latitude=parseFloat(t.Latitude),t["Capacity (MW)"]=parseFloat(t["Capacity (MW)"]),t.name=t["Project Name"]?t["Project Name"]:t.plant,t.name=t.name.replace("station",""),t});var d={};u.forEach(function(t){d.hasOwnProperty(t.name)?d[t.name]["Capacity (MW)"]+=t["Capacity (MW)"]:d[t.name]=t});var y=[];Object.keys(d).forEach(function(t,e){y.push(d[t])}),c.append("text").text(e).attr("class","map-title").attr("y",function(){return f?"120px":i/2}).attr("x",function(){return f?o/2:o-100}).attr("text-anchor",function(){return f?"middle":"end"}),c.append("text").text(function(){return h[e]+" Coal Plants"}).attr("class","map-subtitle").attr("y",function(){return f?150:i/2+35}).attr("x",function(){return f?o/2:o-100}).attr("text-anchor",function(){return f?"middle":"end"}).attr("cursor","pointer").on("click",function(){t.location.href="#project-vis-title"});var x=f?10:25,v=d3.scale.linear().domain([0,d3.max(y,function(t){return t["Capacity (MW)"]})]).range([5,x]);c.selectAll("circle").data(y).enter().append("circle").attr("cx",function(t){return g([t.Longitude,t.Latitude])[0]}).attr("cy",function(t){return g([t.Longitude,t.Latitude])[1]}).attr("r",function(t){return v(t["Capacity (MW)"])}).on("mousemove",function(t){a(t,"<p><strong>Project Name: </strong>"+t["Project Name"]+"</p><p><strong>Type: </strong>"+t.Types+"</p><p><strong>Unit: </strong>"+t.Unit+"</p><p><strong>Year: </strong>"+t["Established Year"]+"</p><p><strong>Status: </strong>"+t.Status+"</p><p><strong>Capacity (MW): </strong>"+t["Capacity (MW)"]+"</p>")}).on("mouseout",n);var C=i-40;c.append("circle").attr("cx",20).attr("cy",C).attr("r","8px").attr("fill","red"),c.append("text").attr("x",35).attr("y",C+5).attr("r","8px").attr("fill","red").attr("class","legend").text("Coal Plants Capacity")})})}function a(t,e){var a=d3.event.pageX+5,n=d3.event.pageY+5;d3.select("#tooltip").style("left",a+"px").style("top",n+"px").html(function(){return e}),d3.select("#tooltip").classed("hidden",!1)}function n(){d3.select("#tooltip").classed("hidden",!0)}var r=["China","Taiwan","Japan","Vietnam","North Korea","South Korea","Philippines","Thailand","Malaysia","Indonesia","Cambodia","Laos","Myanmar","Singapore","Brunei","East Timor","Mongolia"],o=$(t).width(),i=$(t).height(),c=d3.select("#country-map").append("svg").attr("width",o).attr("height",i);d3.select("body").append("div").attr("id","tooltip").classed("hidden",!0),t.init=e}(window);