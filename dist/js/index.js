!function(t){function n(n,s,c,l,u,d){var g=o<600;g&&(c=l);var f=d3.geo.mercator().scale(c).center(s).translate([o/2+10,i/2+50]),m=d3.geo.path().projection(f);d3.json("./data/countries.geo.topo.json",function(s,c){d3.csv(u,function(l){if(s)return console.error(s);var u=topojson.feature(c,c.objects["countries.geo"]).features;u=u.filter(function(t){return t.properties.name===n}),p.append("g").attr("class","countries").selectAll("path").data(u).enter().append("path").attr("d",m).style("display",function(t){return r.indexOf(t.properties.name)>-1?"block":"none"}),p.append("path").attr("class","country-borders").attr("d",m(topojson.mesh(c,c.objects["countries.geo"],function(t,e){return t.properties.name===n&&t!==e}))),l=l.filter(function(t){return"Vietnam"===n?t.country===n&&t.latitude&&t.longitude:t.latitude&&t.longitude}).map(function(t){return t.longitude=parseFloat(t.longitude),t.latitude=parseFloat(t.latitude),t.capacity_mw=parseFloat(t.capacity_mw),t}),p.append("text").text(n).attr("class","map-title").attr("y",function(){return g?"120px":i/2}).attr("x",function(){return g?o/2:o-100}).attr("text-anchor",function(){return g?"middle":"end"}),p.append("text").text(function(){return l.length+" Coal Plants"}).attr("class","map-subtitle").attr("y",function(){return g?150:i/2+35}).attr("x",function(){return g?o/2:o-100}).attr("text-anchor",function(){return g?"middle":"end"}).attr("cursor","pointer").on("click",function(){t.location.href="#project-vis-title"});var d=g?10:25,y=d3.scale.linear().domain([0,d3.max(l,function(t){return t.capacity_mw})]).range([5,d]);p.selectAll("circle").data(l).enter().append("circle").attr("cx",function(t){return f([t.longitude,t.latitude])[0]}).attr("cy",function(t){return f([t.longitude,t.latitude])[1]}).attr("r",function(t){return y(t.capacity_mw)}).on("mousemove",function(t){"Vietnam"===n?e(t,"<p><strong>Plant: </strong>"+t.plant+"</p><p><strong>Capacity (MW): </strong>"+t.capacity_mw+"</p><p><strong>Coal Type: </strong>"+t.coal_type+"</p><p><strong>Unit: </strong>"+t.unit+"</p><p><strong>Year: </strong>"+t.year+"</p><p><strong>Status: </strong>"+t.status+"</p>"):e(t,"<p><strong>Project Name: </strong>"+t["Project Name"]+"</p><p><strong>Capacity (MW): </strong>"+t.capacity_mw+"</p><p><strong>Coal Type: </strong>"+t.Types+"</p><p><strong>Unit: </strong>"+t.Unit+"</p><p><strong>Year: </strong>"+t["Established date (yr)"]+"</p><p><strong>Status: </strong>"+t.Status+"</p>")}).on("mouseout",a);var h=i-40;p.append("circle").attr("cx",20).attr("cy",h).attr("r","8px").attr("fill","red")})})}function e(t,n){var e=d3.event.pageX+5,a=d3.event.pageY+5;d3.select("#tooltip").style("left",e+"px").style("top",a+"px").html(function(){return n}),d3.select("#tooltip").classed("hidden",!1)}function a(){d3.select("#tooltip").classed("hidden",!0)}var r=["China","Taiwan","Japan","Vietnam","North Korea","South Korea","Philippines","Thailand","Malaysia","Indonesia","Cambodia","Laos","Myanmar","Singapore","Brunei","East Timor","Mongolia"],o=$(t).width(),i=$(t).height(),p=d3.select("#country-map").append("svg").attr("width",o).attr("height",i);d3.select("body").append("div").attr("id","tooltip").classed("hidden",!0),t.init=n}(window);