!function(t){var e=["China","Taiwan","Japan","Vietnam","North Korea","South Korea","Philippines","Thailand","Malaysia","Indonesia","Cambodia","Laos","Myanmar","Singapore","Brunei","East Timor","Mongolia"],n=$(t).width(),a=$(t).height(),r=d3.select("#east-asia-map").append("svg").attr("width",n).attr("height",a),o=500,i=n<600;i&&(o=300),d3.select("body").append("div").attr("id","tooltip"),d3.json("data/countries.geo.topo.json",function(t,s){if(t)return console.error(t);var c=[110.5,23],d=d3.geo.mercator().scale(o).center(c).translate([n/2+10,a/2+50]),l=d3.geo.path().projection(d);r.append("g").attr("class","countries").selectAll("path").data(topojson.feature(s,s.objects["countries.geo"]).features).enter().append("path").attr("d",l).style("display",function(t){return e.indexOf(t.properties.name)>-1?"block":"none"}).attr("fill",function(t){if("Vietnam"===t.properties.name)return"rgba(218, 55, 47, 0.9)"}),r.append("path").attr("class","country-borders").attr("d",l(topojson.mesh(s,s.objects["countries.geo"],function(t,n){return e.indexOf(t.properties.name)>-1&&t!==n}))),r.append("text").text("East Asia").attr("class","map-title").attr("y",function(){return i?"150px":a/2}).attr("x",function(){return i?n/2:n/5*4}).attr("text-anchor","middle");var u=topojson.feature(s,s.objects["countries.geo"]).features;u=u.filter(function(t){return"Vietnam"===t.properties.name});var p=u.map(function(t){return{name:t.properties.name,center:l.centroid(t)}});r.selectAll(".place-label").data(p).enter().append("text").attr("class","place-label").text(function(t){return t.name}).attr("x",function(t){return t.center[0]}).attr("y",function(t){return t.center[1]})}),d3.csv("./data/Database- VN - Project 2.csv",function(t){function e(t,e){var n=16,a=t.name,r=t.dx,o=t.dy;for(d3.select(this).style("font-size",n+"px");(this.getBBox().width>=r||this.getBBox().height>=o)&&n>10;)n--,d3.select(this).style("font-size",n+"px"),this.firstChild.data=a;this.parentNode.childNodes[0].getBBox().width-.5<this.getBBox().width&&d3.select(this).style("display","none")}function a(t){var e=d3.event.pageX+5,n=d3.event.pageY+5;d3.select("#tooltip").style("left",e+"px").style("top",n+"px").html(function(){return"<strong>"+t.name+"</strong><p>"+t.value.toFixed(2)+"</p>"}),d3.select("#tooltip").classed("hidden",!1)}function r(){d3.select("#tooltip").classed("hidden",!0)}var o={},i=[];t.forEach(function(t){t["Investing Amount/ Share (mio USD)"]&&t["Financier's name"]&&(o.hasOwnProperty(t["Financier's name"])||(o[t["Financier's name"]]=0),o[t["Financier's name"]]+=parseFloat(t["Investing Amount/ Share (mio USD)"]))});for(var s in o)i.push({name:s,value:o[s]});var c=d3.layout.treemap().size([n,500]),d=c.nodes({children:i});d=d.slice(1,d.length);var l=d3.select("#bank-treemap").append("svg").attr("width",n).attr("height",500),u=l.selectAll("g").data(d).enter().append("g").on("mousemove",a).on("mouseout",r);u.append("rect").attr({x:function(t){return t.x},y:function(t){return t.y},width:function(t){return t.dx},height:function(t){return t.dy},class:"bank-treemap-rect"}),u.append("text").attr({x:function(t){return t.x+t.dx/2},y:function(t){return t.y+t.dy/2},"text-anchor":"middle","dominant-baseline":"central"}).text(function(t){return t.name}).each(e);var p={},h=[];t.forEach(function(t){t["Investing Amount/ Share (mio USD)"]&&t["Financier's name"]&&(p.hasOwnProperty(t["Project Name"])||(p[t["Project Name"]]=0),p[t["Project Name"]]+=parseFloat(t["Investing Amount/ Share (mio USD)"]))});for(var s in p)h.push({name:s,value:p[s]});var f=d3.layout.treemap().size([n,400]),d=f.nodes({children:h});d=d.slice(1,d.length);var m=d3.select("#proj-treemap").append("svg").attr("width",n).attr("height",400),g=m.selectAll("g").data(d).enter().append("g").on("mousemove",a).on("mouseout",r);g.append("rect").attr({x:function(t){return t.x},y:function(t){return t.y},width:function(t){return t.dx},height:function(t){return t.dy},class:"proj-treemap-rect"}),g.append("text").attr({x:function(t){return t.x+t.dx/2},y:function(t){return t.y+t.dy/2},"text-anchor":"middle","dominant-baseline":"central"}).text(function(t){return t.name}).each(e);new Vue({el:"#bank-table",data:{bankArray:i}}),new Vue({el:"#proj-table",data:{projArray:h}})})}(window),function(){d3.csv("flow.csv",function(t,e){function n(){i.attr("d",function(t){var e=t.target.x-t.source.x,n=t.target.y-t.source.y,a=Math.sqrt(e*e+n*n);return"M"+t.source.x+","+t.source.y+"A"+a+","+a+" 0 0,1 "+t.target.x+","+t.target.y}),s.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})}var a={};e.forEach(function(t){t.source=a[t.source]||(a[t.source]={name:t.source}),t.target=a[t.target]||(a[t.target]={name:t.target}),t.value=+t.value});var r=d3.layout.force().nodes(d3.values(a)).links(e).size([960,500]).linkDistance(300).charge(-300).on("tick",n).start(),o=d3.select("#fiance-flow").append("svg").attr("width",960).attr("height",500);o.append("svg:defs").selectAll("marker").data(["end"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",19).attr("refY",-1.5).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5");var i=o.append("svg:g").selectAll("path").data(r.links()).enter().append("svg:path").attr("class","link").attr("marker-end","url(#end)"),s=o.selectAll(".node").data(r.nodes()).enter().append("g").attr("class","node").call(r.drag);s.append("circle").attr("r",30),s.append("text").attr("x",12).attr("dy",".35em").text(function(t){return t.name})})}();