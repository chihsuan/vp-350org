!function(t){var e=["China","Taiwan","Japan","Vietnam","North Korea","South Korea","Philippines","Thailand","Malaysia","Indonesia","Cambodia","Laos","Myanmar","Singapore","Brunei","East Timor","Mongolia"],n=$(t).width(),a=$(t).height(),r=d3.select("#east-asia-map").append("svg").attr("width",n).attr("height",a),o=2e3,i=n<600;i&&(o=1200);var c=[107.7,17],s=d3.geo.mercator().scale(o).center(c).translate([n/2+10,a/2+50]),d=d3.geo.path().projection(s);d3.select("body").append("div").attr("id","tooltip"),d3.json("./data/countries.geo.topo.json",function(t,o){d3.csv("./data/Japan&Vietnam.csv",function(c){if(t)return console.error(t);var u=topojson.feature(o,o.objects["countries.geo"]).features;u=u.filter(function(t){return"Vietnam"===t.properties.name}),r.append("g").attr("class","countries").selectAll("path").data(u).enter().append("path").attr("d",d).style("display",function(t){return e.indexOf(t.properties.name)>-1?"block":"none"}),r.append("path").attr("class","country-borders").attr("d",d(topojson.mesh(o,o.objects["countries.geo"],function(t,e){return"Vietnam"===t.properties.name&&t!==e}))),r.append("text").text("Vietnam").attr("class","map-title").attr("y",function(){return i?"120px":a/2}).attr("x",function(){return i?n/2:n/6*4}).attr("text-anchor","middle"),c=c.filter(function(t){return"Vietnam"===t.country}).map(function(t){return t.longitude=parseFloat(t.longitude),t.latitude=parseFloat(t.latitude),t});var l=d3.scale.linear().domain([0,d3.max(c,function(t){return t.capacity_mw})]).range([5,18]);r.selectAll("circle").data(c).enter().append("circle").attr("cx",function(t){return s([t.longitude,t.latitude])[0]}).attr("cy",function(t){return s([t.longitude,t.latitude])[1]}).attr("r",function(t){return l(t.capacity_mw)});var p=a-25;r.append("circle").attr("cx",30).attr("cy",p).attr("r","8px").attr("fill","red"),r.append("text").attr("x",43).attr("y",p+3).attr("r","8px").attr("fill","red").text("Fossil Project Capacity")})}),d3.csv("./data/Database- VN - Project 2.csv",function(t){function e(t,e){var n=16,a=t.name,r=t.dx,o=t.dy;for(d3.select(this).style("font-size",n+"px");(this.getBBox().width>=r||this.getBBox().height>=o)&&n>10;)n--,d3.select(this).style("font-size",n+"px"),this.firstChild.data=a;this.parentNode.childNodes[0].getBBox().width-.5<this.getBBox().width&&d3.select(this).style("display","none")}function a(t,e){var n=d3.event.pageX+5,a=d3.event.pageY+5;d3.select("#tooltip").style("left",n+"px").style("top",a+"px").html(function(){return e}),d3.select("#tooltip").classed("hidden",!1)}function r(){d3.select("#tooltip").classed("hidden",!0)}var o={},i=[];t.forEach(function(t){t["Investing Amount/ Share (mio USD)"]&&t["Financier's name"]&&(o.hasOwnProperty(t["Financier's name"])||(o[t["Financier's name"]]=0),o[t["Financier's name"]]+=parseFloat(t["Investing Amount/ Share (mio USD)"]))});for(var c in o)i.push({name:c,value:o[c]});var s=i.reduce(function(t,e){return{value:t.value+e.value}});document.getElementById("bank-invest-total").innerText=s.value+" (mio USD)",document.getElementById("proj-total").innerText="520000 (KgCO2)";var d=d3.layout.treemap().size([n,500]),u=d.nodes({children:i});u=u.slice(1,u.length);var l=d3.select("#bank-treemap").append("svg").attr("width",n).attr("height",500),p=l.selectAll("g").data(u).enter().append("g").on("mousemove",function(t){a(t,"<strong>Bank Name:"+t.name+"</strong><p>Investing Amount(mio USD): "+t.value.toFixed(2)+"</p>")}).on("mouseout",r);p.append("rect").attr({x:function(t){return t.x},y:function(t){return t.y},width:function(t){return t.dx},height:function(t){return t.dy},class:"bank-treemap-rect"}),p.append("text").attr({x:function(t){return t.x+t.dx/2},y:function(t){return t.y+t.dy/2},"text-anchor":"middle","dominant-baseline":"central"}).text(function(t){return t.name}).each(e);var m={},h=[];t.forEach(function(t){t["Investing Amount/ Share (mio USD)"]&&t["Financier's name"]&&(m.hasOwnProperty(t["Project Name"])||(m[t["Project Name"]]=0),m[t["Project Name"]]+=parseFloat(t["Investing Amount/ Share (mio USD)"]))});for(var c in m)h.push({name:c,value:m[c]});var f=d3.layout.treemap().size([n,400]),u=f.nodes({children:h});u=u.slice(1,u.length);var g=d3.select("#proj-treemap").append("svg").attr("width",n).attr("height",400),x=g.selectAll("g").data(u).enter().append("g").on("mousemove",function(t){a(t,"<strong>Project Name:"+t.name+"</strong><p>Investing Amount: "+t.value.toFixed(2)+"</p>")}).on("mouseout",r);x.append("rect").attr({x:function(t){return t.x},y:function(t){return t.y},width:function(t){return t.dx},height:function(t){return t.dy},class:"proj-treemap-rect"}),x.append("text").attr({x:function(t){return t.x+t.dx/2},y:function(t){return t.y+t.dy/2},"text-anchor":"middle","dominant-baseline":"central"}).text(function(t){return t.name}).each(e);new Vue({el:"#bank-table",data:{bankArray:i}}),new Vue({el:"#proj-table",data:{projArray:h}})})}(window);